<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
<title>Django-ckeditor后台编辑器应用和绕坑 - JF &#39; blog</title>
<meta name="keywords" content="hexo,hexone">
<meta name="description" content="a theme based on bootstrap">
<meta name="author" content="John Doe">
<meta name="generator" content="hexo">
<meta name="jsonContent" content="/content.json">

<link rel="alternate" href="/atom.xml" title="JF ' blog">

<!-- Bootstrap -->
<link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">

<link rel="stylesheet" href="/css/style.css">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://cdn.bootcss.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->
<link rel="alternate" href="/atom.xml" title="JF ' blog" type="application/atom+xml">
</head>
<body class="bg">
  <div class="container">
    <header id="header" class="header">
    <div class="site-info hidden-xs">
        <p class="title">JF &#39; blog</p>
        <p></p>
        <p class="lead">Information is beautiful</p>
        <!--<p class="subtitle">Information is beautiful</p>-->
        <!--<p class="author">by John Doe</p>-->
    </div>
    <div class="nav-box">
        <nav id="navbar" class="navbar navbar-inverse">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Brand and toggle get grouped for better mobile display -->
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#hexone-navbar-collapse" aria-expanded="false">
                            <span class="sr-only">Toggle navigation</span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <a href="/" class="navbar-brand visible-xs-inline">JF &#39; blog</a>
                    </div>

                    <!-- Collect the nav links, forms, and other content for toggling -->
                    <div class="collapse navbar-collapse">
                        <ul class="nav navbar-nav">
                            
                                
                                    <li class><a href="/">首页</a></li>
                                
                                <li class="divider-vertical"></li>
                            
                                
                                    <li class><a href="/archives">归档</a></li>
                                
                                <li class="divider-vertical"></li>
                            
                                
                                    <li class><a href="/about.html">关于</a></li>
                                
                                <li class="divider-vertical"></li>
                            
                                
                                    <li class="active"><a>Django-ckeditor后台编辑器应用和绕坑</a></li>
                                
                                <li class="divider-vertical"></li>
                            
                        </ul>
                    </div>
                </div><!-- /.navbar-collapse -->
            </div><!-- /.container-fluid -->
        </nav>
    </div>
</header>
    <div class="row">
      <section id="main" class="col-md-9 main">
<article id="post-编程记录/Django-ckeditor后台编辑器应用和绕坑" class="article">
  
    <h1 class="title"><a href="/%E7%BC%96%E7%A8%8B%E8%AE%B0%E5%BD%95/Django-ckeditor%E5%90%8E%E5%8F%B0%E7%BC%96%E8%BE%91%E5%99%A8%E5%BA%94%E7%94%A8%E5%92%8C%E7%BB%95%E5%9D%91/">Django-ckeditor后台编辑器应用和绕坑</a></h1>
  
    <p class="info">
  <span class="info-item">日期: <a href="/archives/2017/07" class="date" title="16:17:48">2017-07-18</a></span>
  <span class="info-item">更新: <a href="javascript: void(0)" class="date" title="10:39:38">2020-04-08</a></span>
  <span class="info-item">分类: <a class="category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AE%B0%E5%BD%95/">编程记录</a></span>
</p>
  
    <div class="content">
  <p>在Django编辑器选择方面我推荐使用ckeditor</p>
<a id="more"></a>
<h1 id="0x01-Django-ckeditor后台编辑器应用和绕坑"><a href="#0x01-Django-ckeditor后台编辑器应用和绕坑" class="headerlink" title="[0x01] Django-ckeditor后台编辑器应用和绕坑"></a>[0x01] Django-ckeditor后台编辑器应用和绕坑</h1><p> <a href="https://github.com/django-ckeditor/django-ckeditor/" target="_blank" rel="external nofollow noopener noreferrer" title="django-ckeditor"><strong>django-ckeditor</strong></a>, star:820 - Django 管理界面与 CKEditor 集成。</p>
<p><a href="https://github.com/summernote/django-summernote/" target="_blank" rel="external nofollow noopener noreferrer" title="django-summernote"><strong>django-summernote</strong></a>, star:325 - Summernote 是一个简单的所见即所得编辑器。django-summernote 能将 Summernote 方便地嵌入到 Django 中。支持 mixins 和 widgets。</p>
<p><a href="https://github.com/aljosa/django-tinymce/" target="_blank" rel="external nofollow noopener noreferrer" title="django-tinymce"><strong>django-tinymce</strong></a>, star:615 - TinyMCE 与 Django 集成。</p>
<p><a href="https://github.com/pydanny/django-wysiwyg/" target="_blank" rel="external nofollow noopener noreferrer" title="django-wysiwyg"><strong>django-wysiwyg</strong></a>, star:440 - 一个 Django 应用，实现将 Django 文本框变成富文本编辑器。可用作模板标签，也可用于表单组件。</p>
<p>虽然百度django-ueditor还不错但是上传图片有漏洞具体可以参考以下文章:<br>在图片上传的路径可以控制文件名导致任意上传和替换原有文件非常危险</p>
<blockquote>
<p><a href="http://blog.nsfocus.net/djangoueditor-file-upload-vulnerability-analysis/" target="_blank" rel="external nofollow noopener noreferrer" title="http://blog.nsfocus.net/djangoueditor-file-upload-vulnerability-analysis/">http://blog.nsfocus.net/djangoueditor-file-upload-vulnerability-analysis/</a></p>
</blockquote>
<h4 id="0x01-安装过程"><a href="#0x01-安装过程" class="headerlink" title="0x01 安装过程"></a>0x01 安装过程</h4><p><a href="https://github.com/django-ckeditor/django-ckeditor/" target="_blank" rel="external nofollow noopener noreferrer">https://github.com/django-ckeditor/django-ckeditor/</a></p>
<hr>
<p>执行命令pip除了安装ckeditor她还会安装依赖<br>比如 django-js_assert</p>
<blockquote>
<p>pip install django-ckeditor<br>如果需要在项目里直接看到ckeditor的文件可以把github源码包中的ckeditor和ckeditor_uploader放入项目内</p>
</blockquote>
<p><strong>这里只介绍在后台添加表单时如何使用ckeditor</strong></p>
<hr>
<p>第一步:<br>在项目中的urls.py文件中加入ckeditor的目录,添加一切外部扩展都必须能让他访问否则什么操作都是无效的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ckeditor_uploader <span class="keyword">import</span> urls <span class="keyword">as</span> ckeditor_uploader_urls</span><br><span class="line">    url(<span class="string">r'^ckeditor/'</span>, include(ckeditor_uploader_urls)),</span><br></pre></td></tr></table></figure>
<p>然后再settings中添加APP</p>
<blockquote>
<p>settings -&gt; INSTALL_APPS 加入 ckeditor, ckeditor_uploader</p>
</blockquote>
<p>第二步:<br>再APP的后台models.py把原来TextField字段变成ckeditor的设置字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ckeditor.fields <span class="keyword">import</span> RichTextField</span><br><span class="line"><span class="keyword">from</span> ckeditor_uploader.fields <span class="keyword">import</span> RichTextUploadingField</span><br></pre></td></tr></table></figure>
<blockquote>
<p>RichTextField字段没有上传按钮<br>RichTextUploadingField存在上传按钮</p>
</blockquote>
<hr>
<p>设置字段</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vul_plan = RichTextUploadingField(verbose_name=<span class="string">'漏洞复测及修复'</span>, config_name=<span class="string">"vul"</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p>初步显示成功<br><img src="/images/ckeditor.png" alt></p>
<h4 id="0x02-定制化编辑器"><a href="#0x02-定制化编辑器" class="headerlink" title="0x02 定制化编辑器"></a>0x02 定制化编辑器</h4><p>看到上面的<strong>config_name</strong>是用来定制化工具栏的可以设置显示哪些需要的工具和栏目的高宽等等非常方便<br>具体设置在settings.py下设置<br>具体可以看官方</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">CKEDITOR_CONFIGS = &#123;</span><br><span class="line">	<span class="comment">#字典内不同的键可以在字段内进行选择</span></span><br><span class="line">    <span class="string">"vul_address"</span>: &#123;</span><br><span class="line">        <span class="string">'toolbar'</span>: <span class="string">'Basic'</span>,<span class="comment"># full,None设置工具栏复杂度</span></span><br><span class="line">        <span class="string">'height'</span>: <span class="number">200</span>,</span><br><span class="line">        <span class="string">'width'</span>: <span class="number">550</span>,</span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="string">"vul"</span>: &#123;</span><br><span class="line">        <span class="string">'height'</span>: <span class="number">300</span>,</span><br><span class="line">        <span class="string">'width'</span>: <span class="number">600</span>,</span><br><span class="line">        <span class="string">'toolbar'</span>: <span class="string">'Custom'</span>,</span><br><span class="line">        <span class="string">'toolbar_Custom'</span>: [</span><br><span class="line">            &#123;<span class="string">'name'</span>: <span class="string">'styles'</span>, <span class="string">'items'</span>: [<span class="string">'Styles'</span>, <span class="string">'Format'</span>, <span class="string">'Font'</span>, <span class="string">'FontSize'</span>]&#125;,</span><br><span class="line">            &#123;<span class="string">'name'</span>: <span class="string">'yourcustomtools'</span>, <span class="string">'items'</span>: [</span><br><span class="line">                <span class="comment"># put the name of your editor.ui.addButton here</span></span><br><span class="line">                <span class="string">'Preview'</span>,</span><br><span class="line">                <span class="string">'Maximize'</span>,</span><br><span class="line">            ]&#125;,</span><br><span class="line">            <span class="string">'/'</span>,</span><br><span class="line"></span><br><span class="line">            [<span class="string">'Bold'</span>, <span class="string">'Italic'</span>, <span class="string">'Underline'</span>],</span><br><span class="line">            &#123;<span class="string">'name'</span>: <span class="string">'colors'</span>, <span class="string">'items'</span>: [<span class="string">'TextColor'</span>, <span class="string">'BGColor'</span>]&#125;,</span><br><span class="line">            [<span class="string">'JustifyLeft'</span>, <span class="string">'JustifyCenter'</span>, <span class="string">'JustifyRight'</span>, <span class="string">'JustifyBlock'</span>],</span><br><span class="line">            &#123;<span class="string">'name'</span>: <span class="string">'tools'</span>, <span class="string">'items'</span>: [<span class="string">'Maximize'</span>, <span class="string">'ShowBlocks'</span>]&#125;,</span><br><span class="line">            &#123;<span class="string">'name'</span>: <span class="string">'insert'</span>,</span><br><span class="line">             <span class="string">'items'</span>: [<span class="string">'Image'</span>, <span class="string">'Table'</span>]&#125;,</span><br><span class="line"></span><br><span class="line">            [<span class="string">'Link'</span>, <span class="string">'Unlink'</span>],</span><br><span class="line">            [<span class="string">'RemoveFormat'</span>, <span class="string">'Source'</span>],</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="0x03-编辑器上传安全应用"><a href="#0x03-编辑器上传安全应用" class="headerlink" title="0x03 编辑器上传安全应用"></a>0x03 编辑器上传安全应用</h4><p>先设置urls.py必须让后台能访问到我上传的资源才行</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> 自己的项目名.settings <span class="keyword">import</span> MEDIA_ROOT</span><br><span class="line"><span class="keyword">from</span> django.views.static <span class="keyword">import</span> serve</span><br><span class="line"></span><br><span class="line">    url(<span class="string">r'^media/(?P&lt;path&gt;.*)$'</span>, serve, &#123;<span class="string">"document_root"</span>: MEDIA_ROOT&#125;),</span><br></pre></td></tr></table></figure>
<p>首先在settings.py下面设置</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#设置静态文件存放目录</span></span><br><span class="line">STATIC_URL = <span class="string">'/static/'</span></span><br><span class="line">STATIC_ROOT = os.path.join(BASE_DIR, <span class="string">'static'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">STATICFILES_DIRS = (</span><br><span class="line">    os.path.join(BASE_DIR, <span class="string">"static"</span>),</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置媒体文件目录</span></span><br><span class="line">MEDIA_URL = <span class="string">'/media/'</span></span><br><span class="line">MEDIA_ROOT = os.path.join(BASE_DIR, <span class="string">'media'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#上传方式</span></span><br><span class="line">CKEDITOR_IMAGE_BACKEND = <span class="string">"pillow"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#上传到的目录</span></span><br><span class="line">CKEDITOR_UPLOAD_PATH = <span class="string">"vul_images"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#只允许上传图片</span></span><br><span class="line">CKEDITOR_ALLOW_NONIMAGE_FILES = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#设置上传的文件名</span></span><br><span class="line">首先在 ckeditor 目录下utils.py文件</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_uuid4_filename</span><span class="params">(filename)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Generates a uuid4 (random) filename, keeping file extension</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    :param filename: Filename passed in. In the general case, this will </span></span><br><span class="line"><span class="string">                     be provided by django-ckeditor's uploader.</span></span><br><span class="line"><span class="string">    :return: Randomized filename in urn format.</span></span><br><span class="line"><span class="string">    :rtype: str</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    discard, ext = os.path.splitext(filename)</span><br><span class="line">    basename = uuid.uuid4()</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'&#123;0&#125;&#123;1&#125;'</span>.format(basename, ext)</span><br><span class="line"></span><br><span class="line">然后再settings.py下设置GENERATOR来指向这个函数,之后上传的文件名会以UUID来命名.</span><br><span class="line"></span><br><span class="line">CKEDITOR_FILENAME_GENERATOR = <span class="string">'ckeditor_uploader.utils.generate_uuid4_filename'</span></span><br></pre></td></tr></table></figure>

</div>
  
    <div class="copyright">
    <p>如无特殊说明，均为原创内容。转载请注明出处！</p>
</div>
  
    
  
    
  <nav aria-label="pager" class="nav-pager">
    <ul class="pager">
      
        <li class="previous"><a href="/%E7%BC%96%E7%A8%8B%E8%AE%B0%E5%BD%95/python%20Django%E5%90%8E%E5%8F%B0%E6%89%A9%E5%B1%95%E4%B9%8Bxadmin%E7%B3%BB%E7%BB%9F%E6%90%AD%E5%BB%BA%E5%92%8C%E4%BC%98%E5%8C%96/"><span aria-hidden="true">&larr;</span> Django后台扩展之xadmin系统搭建和优化</a></li>
      
      
        <li class="next"><a href="/%E7%BC%96%E7%A8%8B%E8%AE%B0%E5%BD%95/%E5%88%A9%E7%94%A8python%E5%8F%91%E9%80%81icmp%E5%8C%85%E8%AF%A6%E8%A7%A3(ping)/">利用python发送icmp包详解(ping) <span aria-hidden="true">&rarr;</span></a></li>
      
    </ul>
  </nav>

  
    
    

  
</article></section>
      <aside class="col-md-3 sidebar">

  <!--<div id="widget-search" class="widget widget-search">-->
  <!--<div class="widget-content">-->
    <!--<form class="form-inline" id="widget-search-form" onsubmit="return false;">-->
      <!--<div class="form-group">-->
        <!--<input type="text" class="form-control" id="widget-search-keyword" placeholder="" autocomplete="off" autofocus>-->
      <!--</div>-->
      <!--<div class="form-group">-->
        <!--<button type="submit" class="btn btn-default">搜索</button>-->
      <!--</div>-->
    <!--</form>-->
    <!--<div class="modal fade widget-search-results" id="widget-search-results" tabindex="-1" role="dialog" aria-labelledby="widget-search-results">-->
      <!--<div class="modal-dialog" role="document">-->
        <!--<div class="modal-content">-->
          <!--<div class="modal-body"></div>-->
        <!--</div>-->
      <!--</div>-->
    <!--</div>-->
  <!--</div>-->
<!--</div>-->

  <div id="widget-toc" class="widget widget-toc">
  <h3 class="widget-title">目录</h3>
  <div class="widget-content">
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#0x01-Django-ckeditor后台编辑器应用和绕坑"><span class="toc-number">1.</span> <span class="toc-text">[0x01] Django-ckeditor后台编辑器应用和绕坑</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#0x01-安装过程"><span class="toc-number">1.0.0.1.</span> <span class="toc-text">0x01 安装过程</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x02-定制化编辑器"><span class="toc-number">1.0.0.2.</span> <span class="toc-text">0x02 定制化编辑器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#0x03-编辑器上传安全应用"><span class="toc-number">1.0.0.3.</span> <span class="toc-text">0x03 编辑器上传安全应用</span></a></li></ol></li></ol>
  </div>
</div>

  <div class="widget">
    <h3 class="widget-title">友情链接</h3>
    <ul>
        <li><a href="http://blog.j0ck1e.com" title target="_blank" rel="external nofollow noopener noreferrer">蓝建</a></li>
        <li><a href="https://www.3cac.com" title target="_blank" rel="external nofollow noopener noreferrer">卡</a></li>
        <li><a href="http://blog.he4rt.me" title target="_blank" rel="external nofollow noopener noreferrer">he4rt</a></li>
        <li><a href="https://sec.mrfan.xyz" title target="_blank" rel="external nofollow noopener noreferrer">饭先生</a></li>
        <li><a href="https://www.waitalone.cn" title target="_blank" rel="external nofollow noopener noreferrer">独自等待</a></li>
        <li><a href="https://www.ch1ng.com" title target="_blank" rel="external nofollow noopener noreferrer">金枪银矛小霸王</a></li>
        <li><a href="https://www.scanfsec.com" title target="_blank" rel="external nofollow noopener noreferrer">scanf</a></li>
    </ul>
</div>
</aside>
      <div class="tools"><a href="javascript: void(0)" class="go-to-top" style="display: none;"><i class="fa fa-chevron-circle-up"></i></a></div>
    </div>
    <footer id="footer" class="footer">
  <p>Powered by <a href="https://hexo.io/" target="_blank" rel="external nofollow noopener noreferrer">Hexo</a>. 勿忘初心.</p>
  
    <!-- Highlight.js -->
    <link rel="stylesheet" href="//cdn.bootcss.com/highlight.js/9.2.0/styles/github.min.css">
    <script src="//cdn.bootcss.com/highlight.js/9.2.0/highlight.min.js">
    </script>
    <script>
      hljs.initHighlightingOnLoad();

    </script>
  
</footer>
  </div>
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!--<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>-->

<script src="/js/jquery.min.js"></script>


<script src="/js/bootstrap.min.js"></script>

<!-- Include all compiled plugins (below), or include individual files as needed -->
<!--<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>-->
<!-- main scripts -->

<script src="/js/main.js"></script>

<!-- seo -->
<script>

</script>
<!-- statistics -->
<div class="hidden">
  
  
  
  
  
</div>
</body>
</html>